<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>readme.html</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
<pre># cors

[![NPM Version][npm-image]][npm-url]
[![NPM Downloads][downloads-image]][downloads-url]
[![Build Status][travis-image]][travis-url]
[![Test Coverage][coveralls-image]][coveralls-url]

CORS is a node.js package for providing a [Connect](http://www.senchalabs.org/connect/)/[Express](http://expressjs.com/) middleware that can be used to enable [CORS](http://en.wikipedia.org/wiki/Cross-origin_resource_sharing) with various options.

**[Follow me (@troygoode) on Twitter!](https://twitter.com/intent/user?screen_name=troygoode)**

* [Installation](#installation)
* [Usage](#usage)
  * [Simple Usage](#simple-usage-enable-all-cors-requests)
  * [Enable CORS for a Single Route](#enable-cors-for-a-single-route)
  * [Configuring CORS](#configuring-cors)
  * [Configuring CORS Asynchronously](#configuring-cors-asynchronously)
  * [Enabling CORS Pre-Flight](#enabling-cors-pre-flight)
* [Configuration Options](#configuration-options)
* [Demo](#demo)
* [License](#license)
* [Author](#author)

## Installation

This is a [Node.js](https://nodejs.org/en/) module available through the
[npm registry](https://www.npmjs.com/). Installation is done using the
[`npm install` command](https://docs.npmjs.com/getting-started/installing-npm-packages-locally):

```sh
$ npm install cors
```

## Usage

### Simple Usage (Enable *All* CORS Requests)

```javascript
var express = require(&#x27;express&#x27;)
var cors = require(&#x27;cors&#x27;)
var app = express()

app.use(cors())

app.get(&#x27;/products/:id&#x27;, function (req, res, next) {
  res.json({msg: &#x27;This is CORS-enabled for all origins!&#x27;})
})

app.listen(80, function () {
  console.log(&#x27;CORS-enabled web server listening on port 80&#x27;)
})
```

### Enable CORS for a Single Route

```javascript
var express = require(&#x27;express&#x27;)
var cors = require(&#x27;cors&#x27;)
var app = express()

app.get(&#x27;/products/:id&#x27;, cors(), function (req, res, next) {
  res.json({msg: &#x27;This is CORS-enabled for a Single Route&#x27;})
})

app.listen(80, function () {
  console.log(&#x27;CORS-enabled web server listening on port 80&#x27;)
})
```

### Configuring CORS

```javascript
var express = require(&#x27;express&#x27;)
var cors = require(&#x27;cors&#x27;)
var app = express()

var corsOptions = {
  origin: &#x27;http://example.com&#x27;,
  optionsSuccessStatus: 200 // some legacy browsers (IE11, various SmartTVs) choke on 204
}

app.get(&#x27;/products/:id&#x27;, cors(corsOptions), function (req, res, next) {
  res.json({msg: &#x27;This is CORS-enabled for only example.com.&#x27;})
})

app.listen(80, function () {
  console.log(&#x27;CORS-enabled web server listening on port 80&#x27;)
})
```

### Configuring CORS w/ Dynamic Origin

```javascript
var express = require(&#x27;express&#x27;)
var cors = require(&#x27;cors&#x27;)
var app = express()

var whitelist = [&#x27;http://example1.com&#x27;, &#x27;http://example2.com&#x27;]
var corsOptions = {
  origin: function (origin, callback) {
    if (whitelist.indexOf(origin) !== -1) {
      callback(null, true)
    } else {
      callback(new Error(&#x27;Not allowed by CORS&#x27;))
    }
  }
}

app.get(&#x27;/products/:id&#x27;, cors(corsOptions), function (req, res, next) {
  res.json({msg: &#x27;This is CORS-enabled for a whitelisted domain.&#x27;})
})

app.listen(80, function () {
  console.log(&#x27;CORS-enabled web server listening on port 80&#x27;)
})
```

If you do not want to block REST tools or server-to-server requests,
add a `!origin` check in the origin function like so:

```javascript
var corsOptions = {
  origin: function (origin, callback) {
    if (whitelist.indexOf(origin) !== -1 || !origin) {
      callback(null, true)
    } else {
      callback(new Error(&#x27;Not allowed by CORS&#x27;))
    }
  }
}
```

### Enabling CORS Pre-Flight

Certain CORS requests are considered &#x27;complex&#x27; and require an initial
`OPTIONS` request (called the &quot;pre-flight request&quot;). An example of a
&#x27;complex&#x27; CORS request is one that uses an HTTP verb other than
GET/HEAD/POST (such as DELETE) or that uses custom headers. To enable
pre-flighting, you must add a new OPTIONS handler for the route you want
to support:

```javascript
var express = require(&#x27;express&#x27;)
var cors = require(&#x27;cors&#x27;)
var app = express()

app.options(&#x27;/products/:id&#x27;, cors()) // enable pre-flight request for DELETE request
app.del(&#x27;/products/:id&#x27;, cors(), function (req, res, next) {
  res.json({msg: &#x27;This is CORS-enabled for all origins!&#x27;})
})

app.listen(80, function () {
  console.log(&#x27;CORS-enabled web server listening on port 80&#x27;)
})
```

You can also enable pre-flight across-the-board like so:

```javascript
app.options(&#x27;*&#x27;, cors()) // include before other routes
```

### Configuring CORS Asynchronously

```javascript
var express = require(&#x27;express&#x27;)
var cors = require(&#x27;cors&#x27;)
var app = express()

var whitelist = [&#x27;http://example1.com&#x27;, &#x27;http://example2.com&#x27;]
var corsOptionsDelegate = function (req, callback) {
  var corsOptions;
  if (whitelist.indexOf(req.header(&#x27;Origin&#x27;)) !== -1) {
    corsOptions = { origin: true } // reflect (enable) the requested origin in the CORS response
  } else {
    corsOptions = { origin: false } // disable CORS for this request
  }
  callback(null, corsOptions) // callback expects two parameters: error and options
}

app.get(&#x27;/products/:id&#x27;, cors(corsOptionsDelegate), function (req, res, next) {
  res.json({msg: &#x27;This is CORS-enabled for a whitelisted domain.&#x27;})
})

app.listen(80, function () {
  console.log(&#x27;CORS-enabled web server listening on port 80&#x27;)
})
```

## Configuration Options

* `origin`: Configures the **Access-Control-Allow-Origin** CORS header. Possible values:
  - `Boolean` - set `origin` to `true` to reflect the [request origin](http://tools.ietf.org/html/draft-abarth-origin-09), as defined by `req.header(&#x27;Origin&#x27;)`, or set it to `false` to disable CORS.
  - `String` - set `origin` to a specific origin. For example if you set it to `&quot;http://example.com&quot;` only requests from &quot;http://example.com&quot; will be allowed.
  - `RegExp` - set `origin` to a regular expression pattern which will be used to test the request origin. If it&#x27;s a match, the request origin will be reflected. For example the pattern `/example\.com$/` will reflect any request that is coming from an origin ending with &quot;example.com&quot;.
  - `Array` - set `origin` to an array of valid origins. Each origin can be a `String` or a `RegExp`. For example `[&quot;http://example1.com&quot;, /\.example2\.com$/]` will accept any request from &quot;http://example1.com&quot; or from a subdomain of &quot;example2.com&quot;.
  - `Function` - set `origin` to a function implementing some custom logic. The function takes the request origin as the first parameter and a callback (which expects the signature `err [object], allow [bool]`) as the second.
* `methods`: Configures the **Access-Control-Allow-Methods** CORS header. Expects a comma-delimited string (ex: &#x27;GET,PUT,POST&#x27;) or an array (ex: `[&#x27;GET&#x27;, &#x27;PUT&#x27;, &#x27;POST&#x27;]`).
* `allowedHeaders`: Configures the **Access-Control-Allow-Headers** CORS header. Expects a comma-delimited string (ex: &#x27;Content-Type,Authorization&#x27;) or an array (ex: `[&#x27;Content-Type&#x27;, &#x27;Authorization&#x27;]`). If not specified, defaults to reflecting the headers specified in the request&#x27;s **Access-Control-Request-Headers** header.
* `exposedHeaders`: Configures the **Access-Control-Expose-Headers** CORS header. Expects a comma-delimited string (ex: &#x27;Content-Range,X-Content-Range&#x27;) or an array (ex: `[&#x27;Content-Range&#x27;, &#x27;X-Content-Range&#x27;]`). If not specified, no custom headers are exposed.
* `credentials`: Configures the **Access-Control-Allow-Credentials** CORS header. Set to `true` to pass the header, otherwise it is omitted.
* `maxAge`: Configures the **Access-Control-Max-Age** CORS header. Set to an integer to pass the header, otherwise it is omitted.
* `preflightContinue`: Pass the CORS preflight response to the next handler.
* `optionsSuccessStatus`: Provides a status code to use for successful `OPTIONS` requests, since some legacy browsers (IE11, various SmartTVs) choke on `204`.

The default configuration is the equivalent of:

```json
{
  &quot;origin&quot;: &quot;*&quot;,
  &quot;methods&quot;: &quot;GET,HEAD,PUT,PATCH,POST,DELETE&quot;,
  &quot;preflightContinue&quot;: false,
  &quot;optionsSuccessStatus&quot;: 204
}
```

For details on the effect of each CORS header, read [this](http://www.html5rocks.com/en/tutorials/cors/) article on HTML5 Rocks.

## Demo

A demo that illustrates CORS working (and not working) using jQuery is available here: [http://node-cors-client.herokuapp.com/](http://node-cors-client.herokuapp.com/)

Code for that demo can be found here:

* Client: [https://github.com/TroyGoode/node-cors-client](https://github.com/TroyGoode/node-cors-client)
* Server: [https://github.com/TroyGoode/node-cors-server](https://github.com/TroyGoode/node-cors-server)

## License

[MIT License](http://www.opensource.org/licenses/mit-license.php)

## Author

[Troy Goode](https://github.com/TroyGoode) ([troygoode@gmail.com](mailto:troygoode@gmail.com))

[coveralls-image]: https://img.shields.io/coveralls/expressjs/cors/master.svg
[coveralls-url]: https://coveralls.io/r/expressjs/cors?branch=master
[downloads-image]: https://img.shields.io/npm/dm/cors.svg
[downloads-url]: https://npmjs.org/package/cors
[npm-image]: https://img.shields.io/npm/v/cors.svg
[npm-url]: https://npmjs.org/package/cors
[travis-image]: https://img.shields.io/travis/expressjs/cors/master.svg
[travis-url]: https://travis-ci.org/expressjs/cors
</pre>
</body>
</html>