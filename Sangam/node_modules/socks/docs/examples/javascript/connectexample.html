<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>connectexample.html</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
<pre># socks examples

## Example for SOCKS &#x27;connect&#x27; command

The connect command is the most common use-case for a SOCKS proxy. This establishes a direct connection to a destination host through a proxy server. The destination host only has knowledge of the proxy server connecting to it and does not know about the origin client (you).

**Origin Client (you) &lt;-&gt; Proxy Server &lt;-&gt; Destination Server**

In this example, we are connecting to a web server on port 80, and sending a very basic HTTP request to receive a response. It&#x27;s worth noting that there are many socks-http-agents that can be used with the node http module (and libraries such as request.js) to make this easier. This HTTP request is used as a simple example.

The &#x27;connect&#x27; command can be used via the SocksClient.createConnection() factory function as well as by creating a SocksClient instance and using event handlers.

### Using createConnection with async/await

Since SocksClient.createConnection returns a Promise, we can easily use async/await for flow control.

```typescript
const SocksClient = require(&#x27;socks&#x27;).SocksClient;

const options  = {
  proxy: {
    host: &#x27;104.131.124.203&#x27;,
    port: 1081,
    type: 5
  },

  destination: {
    host: &#x27;ip-api.com&#x27;, // host names are supported with SOCKS v4a and SOCKS v5.
    port: 80
  },

  command: &#x27;connect&#x27;
};

async function start() {
  try {
    const info = await SocksClient.createConnection(options);

    console.log(info.socket);
    // &lt;Socket ...&gt;  (this is a raw net.Socket that is established to the destination host through the given proxy servers)

    info.socket.write(&#x27;GET /json HTTP/1.1\nHost: ip-api.com\n\n&#x27;);
    info.socket.on(&#x27;data&#x27;, (data) =&gt; {
      console.log(data.toString()); // ip-api.com sees that the last proxy (104.131.124.203) is connected to it and not the origin client (you).
      /*
        HTTP/1.1 200 OK
        Access-Control-Allow-Origin: *
        Content-Type: application/json; charset=utf-8
        Date: Sun, 24 Dec 2017 03:47:51 GMT
        Content-Length: 300

        {
          &quot;as&quot;:&quot;AS14061 Digital Ocean, Inc.&quot;,
          &quot;city&quot;:&quot;Clifton&quot;,
          &quot;country&quot;:&quot;United States&quot;,
          &quot;countryCode&quot;:&quot;US&quot;,
          &quot;isp&quot;:&quot;Digital Ocean&quot;,
          &quot;lat&quot;:40.8326,
          &quot;lon&quot;:-74.1307,
          &quot;org&quot;:&quot;Digital Ocean&quot;,
          &quot;query&quot;:&quot;104.131.124.203&quot;,
          &quot;region&quot;:&quot;NJ&quot;,
          &quot;regionName&quot;:&quot;New Jersey&quot;,
          &quot;status&quot;:&quot;success&quot;,
          &quot;timezone&quot;:&quot;America/New_York&quot;,
          &quot;zip&quot;:&quot;07014&quot;
        }
      */
  } catch (err) {
    // Handle errors
  }
}

start();
```

### Using createConnection with Promises

```typescript
const SocksClient = require(&#x27;socks&#x27;).SocksClient;

const options  = {
  proxy: {
    ipaddress: &#x27;104.131.124.203&#x27;,
    port: 1081,
    type: 5
  },

  destination: {
    host: &#x27;ip-api.com&#x27;, // host names are supported with SOCKS v4a and SOCKS v5.
    port: 80
  },

  command: &#x27;connect&#x27;
};

SocksClient.createConnection(options)
.then(info =&gt; {
  console.log(info.socket);
  // &lt;Socket ...&gt;  (this is a raw net.Socket that is established to the destination host through the given proxy servers)

  info.socket.write(&#x27;GET /json HTTP/1.1\nHost: ip-api.com\n\n&#x27;);
  info.socket.on(&#x27;data&#x27;, (data) =&gt; {
    console.log(data.toString()); // ip-api.com sees that the last proxy (104.131.124.203) is connected to it and not the origin client (you).
    /*
      HTTP/1.1 200 OK
      Access-Control-Allow-Origin: *
      Content-Type: application/json; charset=utf-8
      Date: Sun, 24 Dec 2017 03:47:51 GMT
      Content-Length: 300

      {
        &quot;as&quot;:&quot;AS14061 Digital Ocean, Inc.&quot;,
        &quot;city&quot;:&quot;Clifton&quot;,
        &quot;country&quot;:&quot;United States&quot;,
        &quot;countryCode&quot;:&quot;US&quot;,
        &quot;isp&quot;:&quot;Digital Ocean&quot;,
        &quot;lat&quot;:40.8326,
        &quot;lon&quot;:-74.1307,
        &quot;org&quot;:&quot;Digital Ocean&quot;,
        &quot;query&quot;:&quot;104.131.124.203&quot;,
        &quot;region&quot;:&quot;NJ&quot;,
        &quot;regionName&quot;:&quot;New Jersey&quot;,
        &quot;status&quot;:&quot;success&quot;,
        &quot;timezone&quot;:&quot;America/New_York&quot;,
        &quot;zip&quot;:&quot;07014&quot;
      }
    */
})
.catch(err =&gt; {
  // handle errors
});
```

### Using createConnection with callbacks

SocksClient.createConnection() optionally accepts a callback function as a second parameter.

**Note:** If a callback function is provided, a Promise is still returned from the function, but the promise will always resolve regardless of if there was en error. (tldr: Do not mix callbacks and Promises).

```typescript
const SocksClient = require(&#x27;socks&#x27;).SocksClient;

const options  = {
  proxy: {
    ipaddress: &#x27;104.131.124.203&#x27;,
    port: 1081,
    type: 5
  },

  destination: {
    host: &#x27;ip-api.com&#x27;, // host names are supported with SOCKS v4a and SOCKS v5.
    port: 80
  },

  command: &#x27;connect&#x27;
};

SocksClient.createConnection(options, (err, info) =&gt; {
  if (err) {
    // handle errors
  } else {
    console.log(info.socket);
    // &lt;Socket ...&gt;  (this is a raw net.Socket that is established to the destination host through the given proxy servers)

    info.socket.write(&#x27;GET /json HTTP/1.1\nHost: ip-api.com\n\n&#x27;);
    info.socket.on(&#x27;data&#x27;, (data) =&gt; {
      console.log(data.toString()); // ip-api.com sees that the last proxy (104.131.124.203) is connected to it and not the origin client (you).
      /*
        HTTP/1.1 200 OK
        Access-Control-Allow-Origin: *
        Content-Type: application/json; charset=utf-8
        Date: Sun, 24 Dec 2017 03:47:51 GMT
        Content-Length: 300

        {
          &quot;as&quot;:&quot;AS14061 Digital Ocean, Inc.&quot;,
          &quot;city&quot;:&quot;Clifton&quot;,
          &quot;country&quot;:&quot;United States&quot;,
          &quot;countryCode&quot;:&quot;US&quot;,
          &quot;isp&quot;:&quot;Digital Ocean&quot;,
          &quot;lat&quot;:40.8326,
          &quot;lon&quot;:-74.1307,
          &quot;org&quot;:&quot;Digital Ocean&quot;,
          &quot;query&quot;:&quot;104.131.124.203&quot;,
          &quot;region&quot;:&quot;NJ&quot;,
          &quot;regionName&quot;:&quot;New Jersey&quot;,
          &quot;status&quot;:&quot;success&quot;,
          &quot;timezone&quot;:&quot;America/New_York&quot;,
          &quot;zip&quot;:&quot;07014&quot;
        }
      */
  }
})
```

### Using event handlers

SocksClient also supports instance creation of a SocksClient. This allows for event based flow control.

```typescript
const SocksClient = require(&#x27;socks&#x27;).SocksClient;

const options  = {
  proxy: {
    ipaddress: &#x27;104.131.124.203&#x27;,
    port: 1081,
    type: 5
  },

  destination: {
    host: &#x27;ip-api.com&#x27;, // host names are supported with SOCKS v4a and SOCKS v5.
    port: 80
  },

  command: &#x27;connect&#x27;
};

const client = new SocksClient(options);

client.on(&#x27;established&#x27;, (info) =&gt; {
  console.log(info.socket);
  // &lt;Socket ...&gt;  (this is a raw net.Socket that is established to the destination host through the given proxy servers)

  info.socket.write(&#x27;GET /json HTTP/1.1\nHost: ip-api.com\n\n&#x27;);
  info.socket.on(&#x27;data&#x27;, (data) =&gt; {
    console.log(data.toString()); // ip-api.com sees that the last proxy (104.131.124.203) is connected to it and not the origin client (you).
    /*
      HTTP/1.1 200 OK
      Access-Control-Allow-Origin: *
      Content-Type: application/json; charset=utf-8
      Date: Sun, 24 Dec 2017 03:47:51 GMT
      Content-Length: 300

      {
        &quot;as&quot;:&quot;AS14061 Digital Ocean, Inc.&quot;,
        &quot;city&quot;:&quot;Clifton&quot;,
        &quot;country&quot;:&quot;United States&quot;,
        &quot;countryCode&quot;:&quot;US&quot;,
        &quot;isp&quot;:&quot;Digital Ocean&quot;,
        &quot;lat&quot;:40.8326,
        &quot;lon&quot;:-74.1307,
        &quot;org&quot;:&quot;Digital Ocean&quot;,
        &quot;query&quot;:&quot;104.131.124.203&quot;,
        &quot;region&quot;:&quot;NJ&quot;,
        &quot;regionName&quot;:&quot;New Jersey&quot;,
        &quot;status&quot;:&quot;success&quot;,
        &quot;timezone&quot;:&quot;America/New_York&quot;,
        &quot;zip&quot;:&quot;07014&quot;
      }
    */
});

// Failed to establish proxy connection to destination.
client.on(&#x27;error&#x27;, () =&gt; {
  // Handle errors
});
```</pre>
</body>
</html>